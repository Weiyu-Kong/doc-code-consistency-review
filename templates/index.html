<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>需求-代码一致性审查平台</title>

    <link rel="stylesheet" href="../static/css/index.css">
    <link rel="stylesheet" href="../static/js/thirdParty/highlight/default.min.css">
    <link rel="stylesheet" href="../static/js/thirdParty/katex/katex.min.css">
    <link rel="stylesheet" href="../static/js/thirdParty/element/index.css">
    <link rel="stylesheet" href="../static/js/thirdParty/element/index.iife.min.js">

    <script src="../static/js/thirdParty/vue.global.js"></script>
    <script src="../static/js/thirdParty/katex/katex.min.js"></script>
    <script src="../static/js/thirdParty/auto-render.min.js"></script>
    <script src="../static/js/thirdParty/axios.min.js"></script>
    <script src="../static/js/thirdParty/marked.min.js"></script>
    <script src="../static/js/thirdParty/highlight/highlight.min.js"></script>
    <script src="../static/js/thirdParty/element/index.full.js"></script>
    <script src="../static/js/thirdParty/element/icons-vue.js"></script>
</head>
<body>
<div id="app">
    <!-- 标头 -->
    <header>
        <img src="../static/assets/Web Development Lineart_Find code.png" alt="Platform Icon" class="header-icon">
        <h1 class="title">需求-代码一致性审查平台</h1>
        <button class="upload-button" @click="showUpload=true">
            <el-icon><Upload /></el-icon>
        </button>
    </header>
    
    <!-- 主体 展示+功能 -->
    <el-splitter>
        <!-- 展示区域 -->
        <el-splitter-panel size="70%" :min="600">
            <el-row class="main-content">
                <!-- 需求文档展示区 -->
                <el-scrollbar class="block" id="requirements" height="90vh">
                    <div class="section-header">
                        <el-icon><Document /></el-icon>
                        需求文档         
                    </div>
                    <div v-html="requirements"></div>
                </el-scrollbar>

                <!-- 代码展示区 -->
                <el-scrollbar class="block" id="code" height="90vh">
                    <div class="section-header">
                        <el-icon><Tickets /></el-icon>
                        代码
                    </div>
                    <el-collapse v-model="activeNames" @change="handleChange">
                        <el-collapse-item 
                            v-for="(file, index) in codeFiles" 
                            :key="index" 
                            :title="file.name" 
                            :name="index">
                            <pre><code class="language-cpp">${file.content}</code></pre>
                        </el-collapse-item>
                    </el-collapse>
                </el-scrollbar>
            </el-row>
        </el-splitter-panel>

        <!-- 功能区域 -->
        <el-splitter-panel :min="200">
            <el-tabs class="tab-card" type="border-card">
                <!-- 对齐 滚动条 -->
                <el-tab-pane label="需求-代码对齐">
                    <el-button-group class="button-group">
                        <el-button type="primary" @click="autoAlign">解析并自动对齐</el-button>
                        <el-button type="primary" disabled="true" @click="importAlignment">导入对齐</el-button>
                        <el-button type="primary" disabled="true" @click="exportAlignment">导出对齐</el-button>
                    </el-button-group>
                    <el-scrollbar v-loading="alignAllReqLoading" max-height="600px" class="requirement-points">
                        <div 
                            v-for="(point, index) in requirementPoints" 
                            :key="index" 
                            class="requirement-point" 
                            @click="handleRequirementClick(point)"
                        >
                            <div class="requirement-header">
                                <!-- <span class="requirement-type">${ point.type }</span> -->
                                <span class="requirement-id">${ point.id }</span>
                                <el-button-group>
                                    <el-button 
                                        type="primary" 
                                        size="small" 
                                        text
                                        bg
                                        @click.stop="alignSingleRequirement(point)"
                                    >
                                        对齐
                                    </el-button>
                                    <el-button 
                                        type="danger" 
                                        size="small" 
                                        text
                                        bg
                                        @click.stop="removeSingleRequirement(point)"
                                    >
                                        删除
                                    </el-button>
                                </el-button-group>
                            </div>
                            <div class="requirement-content">
                                <template v-if="point.type === '表格行'">
                                    <div v-html="renderMarkdownTableLine(point.content)"></div>
                                </template>
                                <template v-else>
                                    <div v-html="renderMarkdown(point.content)"></div>
                                </template>
                            </div>
                            <div class="requirement-context">
                                <small>${ point.context }</small>
                            </div>
                            <el-divider></el-divider>
                            <div v-for="block in point.associated_code" :key="block.name" class="associated-code">
                                <div class="requirement-context">
                                    <small>${ block.filename }</small>
                                </div>
                                <pre><code class="language-cpp">${ block.content }</code></pre>
                            </div>
                        </div>
                    </el-scrollbar>
                </el-tab-pane>
                <!-- 审查 分页 -->
                <el-tab-pane label="一致性审查">
                    <el-scrollbar height="80vh">
                        <div v-if="requirementPoints.length > 0" class="requirement-point">
                            <div class="requirement-header">
                                <span class="requirement-id">${ requirementPoints[currentPage - 1].id }</span>
                                <!-- <span class="requirement-type">${ requirementPoints[currentPage - 1].type }</span> -->
                                <el-button 
                                    type="primary" 
                                    size="small" 
                                    text
                                    bg
                                    @click.stop="reviewSingleRequirement(requirementPoints[currentPage - 1])"
                                >
                                    审查
                                </el-button>
                            </div>
                            <div class="requirement-content">
                                <template v-if="requirementPoints[currentPage - 1].type === '表格行'">
                                    <div v-html="renderMarkdownTableLine(requirementPoints[currentPage - 1].content)"></div>
                                </template>
                                <template v-else>
                                    <div v-html="renderMarkdown(requirementPoints[currentPage - 1].content)"></div>
                                </template>
                            </div>
                            <div class="requirement-context">
                                <small>${ requirementPoints[currentPage - 1].context }</small>
                            </div>
                            <el-divider></el-divider>
                            <div v-for="block in requirementPoints[currentPage - 1].associated_code" :key="block.name" class="associated-code">
                                <div class="requirement-context">
                                    <small>${ block.filename }</small>
                                </div>
                                <pre><code class="language-cpp">${ block.content }</code></pre>
                            </div>
                        </div>
                    </el-scrollbar>
                    <el-pagination
                        v-model:current-page="currentPage"
                        size="small"
                        background
                        :page-size="1"
                        :total="requirementPoints.length"
                        layout="prev, pager, next"
                        class="pagination"
                    ></el-pagination>
                </el-tab-pane>
            </el-tabs>
        </el-splitter-panel>
    </el-splitter>

    <!-- 抽屉 打开文件 -->
    <el-drawer 
        class="upload-drawer"
        v-model="showUpload" 
        :with-header="false" 
        direction="rtl"
        size="25%"
    >
        <el-divider><el-icon><star-filled /></el-icon></el-divider>

        <div class="upload-center">
            <div class="upload-border">
                <el-upload
                    class="upload-demo"
                    action=""
                    :auto-upload="false"
                    :on-change="handleRequirementUploadChange"
                    :on-remove="handleRequirementRemove"
                    accept=".md"
                    :file-list="requirementFileList"
                    :limit="1"
                    :on-exceed="handleRequirementExceed"
                >
                    <button class="upload-file-button">打开需求文档</button>
                    <template #tip>
                    <div class="el-upload__tip">
                        需求文档，支持Markdown格式(.md)
                    </div>
                    </template>
                </el-upload>
            </div>
            
            <div class="upload-border">
                <el-upload
                    class="upload-demo"
                    action=""
                    :auto-upload="false"
                    :on-change="handleUploadChange"
                    :on-remove="handleRemove"
                    multiple
                    accept=".h,.c,.cpp"
                    :file-list="fileList"
                >
                    <button class="upload-file-button">打开代码文件</button>
                    <template #tip>
                    <div class="el-upload__tip">
                        代码文件，支持C/C++语言(.h, .c, .cpp)
                    </div>
                    </template>
                </el-upload>
            </div>
        </div>
    </el-drawer>
</div>

<script src="../static/js/app.js"></script>
</body>
</html>

